<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>注册</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/common.css" />
</head>

<style>
    .info-text{
        color: red;
        margin-left: 40px;
        display: none;
    }
    .must{
        color:red;
        padding-right: 5px;
    }
    .no-must{
        padding: 5px;
    }
</style>

<body>
<div class="wrap login_wrap">
    <div class="content">

        <div class="logo"></div>

        <div class="login_box2">

            <div class="login_form">
                <div class="login_title">
                    注册
                </div>
                <form class="form-flex" id="form-id">
                    <div class="left">
                        <div class="form-border">
                            <span>&nbsp;&nbsp;&nbsp;<span class="must">*</span>邮箱：&nbsp;&nbsp;&nbsp;</span>
                            <input name="email" class="email" type="text" placeholder="邮箱">
                        </div>
                        <div class="form-border">
                            <span>&nbsp;&nbsp;<span class="must">*</span>用户名：&nbsp;</span>
                            <input name="username" type="text" class="username" placeholder="请输入小于10位的用户名">
                        </div>
                        <div class="form-border">
                            <span>&nbsp;&nbsp;&nbsp;<span class="must">*</span>密码：&nbsp;&nbsp;&nbsp;</span>
                            <input name="password" type="password" class="password" placeholder="密码">
                        </div>
                        <div class="form-border">
                            <span>&nbsp;&nbsp;&nbsp;<span class="no-must"></span>省份：&nbsp;&nbsp;&nbsp;</span>
                            <input name="city" class="city" type="text" placeholder="省份">
                        </div>
                        <div class="form-border">
                            <span>&nbsp;&nbsp;&nbsp;<span class="no-must"></span>学校：&nbsp;&nbsp;&nbsp;</span>
                            <input name="school" class="school" type="text" placeholder="学校">
                        </div>
                        <div class="info-text">错误</div>
                        <div class="form_btn register-href">
                            <button type="button" class="register">注册</button>
                        </div>
                    </div>
                    <div class="right">
                        <div class="form-border">
                            <span><span class="must">*</span>手机号码：</span>
                            <input name="phoneNumber" class="phoneNumber" type="text" placeholder="手机号码">
                        </div>
                        <div class="sex">
                            <span>&nbsp;&nbsp;&nbsp;<span class="must">*</span>性别：&nbsp;&nbsp;&nbsp;</span>
                            <input name="sex" class="sex_check" type="radio" value="女">女
                            <input name="sex" class="sex_check" type="radio" value="男">男
                        </div>
                        <div class="form-border">
                            <span><span class="must">*</span>重复密码：</span>
                            <input name="repassword" class="repassword" type="password" placeholder="重复密码">
                        </div>
                        <div class="form-border">
                            <span>&nbsp;&nbsp;&nbsp;<span class="no-must"></span>城市：&nbsp;&nbsp;&nbsp;</span>
                            <input name="address" class="address" type="text" placeholder="城市">
                        </div>
                        <div class="form-border">
                            <span>&nbsp;&nbsp;&nbsp;<span class="no-must"></span>生日：&nbsp;&nbsp;&nbsp;</span>
                            <input name="birthday" class="birthday" type="text" placeholder="生日">
                        </div>
                        <div class="form_reg_btn register-btn">
                            <span>已有帐号？</span><a href="/login">马上登录</a>
                        </div>
                    </div>



                </form>
                <!--<div class="other_login">-->
                    <!--<div class="left other_left">-->
                        <!--<span>其它登录方式</span>-->
                    <!--</div>-->
                    <!--<div class="right other_right">-->
                        <!--<a href="#">QQ登录</a>-->
                        <!--<a href="#">微信登录</a>-->
                        <!--<a href="#">微博登录</a>-->
                    <!--</div>-->
                <!--</div>-->
            </div>
        </div>
    </div>
</div>
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script>
    $(function(){
        var username = false
        var email = false
        var phoneNumber = false
        var password = false
        //表单验证
        // username
        $(".username").blur(function(){
            if ($(this).val() == '') {
                username = false
                $(".info-text").show().text("请输入用户名")
                $(this).css("borderColor", 'red')
                $(".register-href").css("marginTop", "10px")
            } else {
                if($(this).val().length > 10) {
                    username = false
                    $(".info-text").show().text("用户名长度不能大于10哦")
                    $(this).css("borderColor", 'red')
                    $(".register-href").css("marginTop", "10px")
                } else {
                    username = true
                    $(this).css("borderColor", '#ccc')
                    $(".register-href").css("marginTop", "40px")
                    $(".info-text").hide()
                }
            }
        })
        // password
        $(".password,.repassword").blur(function(){
            if ($(".password").val() != '' && $(".repassword").val() != ''){
                if ($(".password").val() != $(".repassword").val()){
                    password = false
                    $(".info-text").show().text("两次密码输入不相同")
                    $(this).css("borderColor", 'red')
                    $(".register-href").css("marginTop", "10px")
                }else{
                    password = true
                    $(".register-href").css("marginTop", "40px")
                    $(".password,.repassword").css("borderColor", '#ccc')
                    $(".info-text").hide()
                }
            }
        })
        // email
        $(".email").blur(function(){
            if(/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test($(this).val())){
                $(".register-href").css("marginTop", "40px")
                $(this).css("borderColor", '#ccc')
                $(".info-text").hide()
                email = true
            } else {
                email = false
                $(".info-text").show().text("请输入正确的email地址")
                $(this).css("borderColor", 'red')
                $(".register-href").css("marginTop", "10px")
            }
        })
        // phone-number
        $(".phoneNumber").blur(function(){
            if (/^((1[3,5,8][0-9])|(14[5,7])|(17[0,6,7,8])|(19[7]))\d{8}$/.test($(this).val())){
                phoneNumber = true
                $(".register-href").css("marginTop", "40px")
                $(this).css("borderColor", '#ccc')
                $(".info-text").hide()
            }else{
                phoneNumber = false
                $(".info-text").show().text("请输入正确的手机号码")
                $(this).css("borderColor", 'red')
                $(".register-href").css("marginTop", "10px")
            }
        })
        // 聚焦的时候 全部清除
        $("input").focus(function(){
            $(".register-href").css("marginTop", "40px")
            $(this).css("borderColor", '#ccc')
            $(".info-text").hide()
        })
        // click
        $(".register").click(function(){
            if (email && phoneNumber && username && sex && password) {
                var array = $("#form-id").serializeArray()
                var obj = {}
                array.forEach((value, index, array) => {
                    obj[value.name] = value.value
                })
                $.ajax({
                    url: "/registerCheck",
                    type: "post",
                    data: obj,
                    beforeSend: function(){
                        console.log("正在发送ajax请求")
                    },
                    success:function(data){
                        console.log(data)
                        if (data == '1') {
                            window.location.href = "/login"
                        } else if (data == '2'){
                            $(".info-text").show().text("sorry,注册失败")
                            $(".register-href").css("marginTop", "10px")
                        }
                    },
                    error:function(err){
                        console.log("请求错误",err)
                    }
                })
            }else{
                $(".info-text").show().text("请填写相应的内容")
                $(".register-href").css("marginTop", "10px")
                return false
            }
        })
    });
</script>
</body>
</html>
